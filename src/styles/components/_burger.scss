@use "../variables" as v;
@use "../mixins" as m;
@use "../pixel" as pb;

// ─── 버거 스택 영역 ───────────────────────────────────
// 카메라 뷰포트 역할: 높이를 채우고 넘치는 부분을 가림
.burger-stack {
  position: relative;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  // overflow: hidden;
  height: 100%;

  @include m.mobile {
    // 컨테이너 너비(cqw)와 높이(cqh) 중 작은 값으로 제한
    width: min(90cqw, 55cqh);
  }
  @include m.desktop {
    width: min(90cqw, 55cqh);
  }
}

// ─── 카메라 래퍼 (translateY로 버거 상단을 따라가는 역할) ─
// burger-food의 제출 애니메이션(scale)과 transform이 충돌하지 않도록 분리
.burger-camera {
  width: 100%;
  flex-shrink: 0;
  will-change: transform;
}

// ─── 음식 레이어 컨테이너 (제출 시 통째로 애니메이션) ─
.burger-food {
  display: flex;
  flex-direction: column-reverse;
  align-items: center;
  justify-content: flex-end;
  width: 100%;

  // 제출 확정: 팝업 → 소멸
  &--submitting {
    animation: burger-submit 0.55s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }
}

// ─── 번 이미지 ────────────────────────────────────────
.burger-bun {
  width: 100%;
  display: block;
  image-rendering: pixelated;
  position: relative;
  z-index: 0;

  // 완성 후 새 바닥번이 점에서 튀어나오는 애니메이션
  &--fresh {
    animation: bun-appear 0.38s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  // 위 번: food 레이어 맨 위에 위치 (column-reverse 상 시각적 최상단)
  &--top {
    position: relative;
    z-index: 2;
    margin-bottom: -32%;
  }
}

// ─── 재료 레이어 (이미지) ─────────────────────────────
.ingredient-layer {
  width: 100%;
  position: relative;
  z-index: 1;
  // 위에서 떨어지는 애니메이션 (column-reverse 이므로 재료는 시각적으로 위에서 내려옴)
  animation: drop-in 0.22s cubic-bezier(0.22, 0.61, 0.36, 1);

  &.ingredient-layer--veggie {
    margin-bottom: -32%;
  }
  &.ingredient-layer--cheese {
    margin-bottom: -36%;
  }
  &.ingredient-layer--sauce {
    margin-bottom: -31%;
  }
  &.ingredient-layer--patty {
    margin-bottom: -32%;
  }
  &.ingredient-layer--onion {
    margin-bottom: -32%;
  }
  &.ingredient-layer--tomato {
    margin-bottom: -30%;
  }

  img {
    width: 100%;
    height: auto;
    display: block;
    image-rendering: pixelated;
  }
}

// ─── 제출 플래시 오버레이 ─────────────────────────────
// burger-food 바깥에 위치 → 독립적으로 애니메이션
.burger-flash {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-family: v.$font-pixel;
  pointer-events: none;
  border-radius: 2px;

  @include m.mobile {
    gap: m.vw(4);
  }
  @include m.desktop {
    gap: 4px;
  }

  // 점수 숫자 (+100, +500 등)
  &__score {
    font-weight: bold;
    line-height: 1;
    @include m.mobile {
      font-size: m.vw(28);
    }
    @include m.desktop {
      font-size: 34px;
    }
  }

  // "×1.5 COMBO!" 텍스트
  &__combo {
    line-height: 1;
    @include m.mobile {
      font-size: m.vw(13);
    }
    @include m.desktop {
      font-size: 15px;
    }
  }

  // 일반 정답
  &--correct {
    color: v.$color-success;
    animation: flash-score-up 0.65s ease-out forwards;
  }

  // 콤보 정답 (금색)
  &--combo {
    color: #f0b429;
    text-shadow: 0 0 8px rgba(240, 180, 41, 0.6);
  }

  // 오답: 더 크고 강렬하게
  &--wrong {
    background: rgba(217, 48, 37, 0.25);
    color: v.$color-danger;
    font-weight: bold;
    text-shadow: 0 0 10px rgba(217, 48, 37, 0.5);
    animation: flash-miss 0.5s ease-out forwards;
    @include m.mobile {
      font-size: m.vw(32);
    }
    @include m.desktop {
      font-size: 40px;
    }
  }
}

// ─── 키프레임 ─────────────────────────────────────────

// 재료가 위에서 떨어지는 모션
@keyframes drop-in {
  from {
    transform: translateY(-60px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

// 제출 확정: 살짝 부풀었다가 점으로 소멸
@keyframes burger-submit {
  0% {
    transform: scale(1);
    opacity: 1;
  }
  22% {
    transform: scale(1.18);
    opacity: 1;
  }
  100% {
    transform: scale(0);
    opacity: 0;
  }
}

// 새 바닥 번: 점에서 스프링처럼 튀어나옴
@keyframes bun-appear {
  0% {
    transform: scale(0.05);
    opacity: 0.5;
  }
  65% {
    transform: scale(1.1);
    opacity: 1;
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

// 점수가 위로 떠오르며 사라지는 모션
@keyframes flash-score-up {
  0% {
    transform: scale(1.3) translateY(0);
    opacity: 1;
  }
  60% {
    transform: scale(1) translateY(-18px);
    opacity: 0.9;
  }
  100% {
    transform: scale(0.85) translateY(-32px);
    opacity: 0;
  }
}

// MISS! 크게 번쩍이다 사라지는 모션
@keyframes flash-miss {
  0% {
    transform: scale(1.5);
    opacity: 1;
  }
  40% {
    transform: scale(1);
    opacity: 1;
  }
  100% {
    transform: scale(0.9);
    opacity: 0;
  }
}
